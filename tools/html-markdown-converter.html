<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTML ↔ Markdown 转换工具</title>
  <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/turndown@7.1.3/dist/turndown.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      background: #FAFAFA;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 10px;
      color: #000;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }

    .tools-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .tool-section {
      background: #FFFFFF;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      padding: 20px;
    }

    .tool-section h2 {
      font-size: 1.3em;
      margin-bottom: 15px;
      color: #000;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tool-section h2::before {
      content: '↔';
      font-size: 1.2em;
    }

    textarea {
      width: 100%;
      min-height: 400px;
      padding: 15px;
      border: 1px solid rgba(0, 0, 0, 0.2);
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      background: #FAFAFA;
    }

    textarea:focus {
      outline: none;
      border-color: #000;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    button {
      padding: 10px 20px;
      background: #000;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: opacity 0.2s;
    }

    button:hover {
      opacity: 0.8;
    }

    button.secondary {
      background: #666;
    }

    button.success {
      background: #28a745;
    }

    .output-section {
      margin-top: 20px;
    }

    .output-section h3 {
      font-size: 1.1em;
      margin-bottom: 10px;
      color: #333;
    }

    #htmlOutput,
    #markdownOutput {
      min-height: 200px;
      max-height: 500px;
      overflow-y: auto;
    }

    .info-box {
      background: rgba(0, 0, 0, 0.02);
      border-left: 3px solid rgba(0, 0, 0, 0.2);
      padding: 15px;
      margin-top: 20px;
      border-radius: 0 4px 4px 0;
      font-size: 0.9em;
      color: #666;
    }

    .info-box strong {
      color: #000;
    }

    @media (max-width: 1024px) {
      .tools-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>HTML ↔ Markdown 转换工具</h1>
    <p class="subtitle">双向转换工具：从 HTML 提取为 Markdown 方便编辑，或从 Markdown 生成 HTML 插入页面</p>

    <div class="tools-container">
      <!-- HTML 转 Markdown -->
      <div class="tool-section">
        <h2>HTML → Markdown</h2>
        <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">
          粘贴 HTML 代码，转换为 Markdown 格式方便编辑
        </p>
        <textarea id="htmlInput" placeholder="粘贴 HTML 代码，例如：
<h2>管理层</h2>
<h3><a href=&quot;https://example.com&quot;>标题</a></h3>
<p>这是段落内容</p>
<ul>
  <li>列表项 1</li>
  <li>列表项 2</li>
</ul>"></textarea>
        <div class="button-group">
          <button onclick="convertHTMLToMarkdown()">转换为 Markdown</button>
          <button class="secondary" onclick="clearHTML()">清空</button>
        </div>
        <div class="output-section">
          <h3>Markdown 输出：</h3>
          <textarea id="markdownOutput" readonly placeholder="转换后的 Markdown 将显示在这里..."></textarea>
          <div class="button-group">
            <button class="success" onclick="copyMarkdown()">复制 Markdown</button>
          </div>
        </div>
      </div>

      <!-- Markdown 转 HTML -->
      <div class="tool-section">
        <h2>Markdown → HTML</h2>
        <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">
          输入 Markdown 内容，转换为 HTML 格式插入页面
        </p>
        <textarea id="markdownInput" placeholder="输入 Markdown 内容，例如：
## 管理层

### [标题](https://example.com)

这是段落内容

- 列表项 1
- 列表项 2

**加粗文本** 和 *斜体文本*"></textarea>
        <div class="button-group">
          <button onclick="convertMarkdownToHTML()">转换为 HTML</button>
          <button class="secondary" onclick="clearMarkdown()">清空</button>
        </div>
        <div class="output-section">
          <h3>HTML 输出：</h3>
          <textarea id="htmlOutput" readonly placeholder="转换后的 HTML 将显示在这里..."></textarea>
          <div class="button-group">
            <button class="success" onclick="copyHTML()">复制 HTML</button>
          </div>
        </div>
      </div>
    </div>

    <div class="info-box">
      <strong>使用提示：</strong><br>
      • <strong>HTML → Markdown</strong>：从现有 HTML 页面复制内容，转换为 Markdown 方便日常编辑<br>
      • <strong>Markdown → HTML</strong>：编辑好 Markdown 后，转换为 HTML 插入到页面中<br>
      • 转换后的 HTML 会保持你页面的样式结构（如 h2, h3, p, ul, li 等标签）<br>
      • 链接会自动转换为带 target="_blank" 的格式（可在代码中调整）<br>
      • 快捷键：Ctrl+Enter 快速转换
    </div>
  </div>

  <script>
    // 配置 Turndown (HTML → Markdown)
    const turndownService = new TurndownService({
      headingStyle: 'atx',
      codeBlockStyle: 'fenced',
      bulletListMarker: '-',
      emDelimiter: '*',
      strongDelimiter: '**',
    });

    // 配置 Marked (Markdown → HTML)
    marked.setOptions({
      breaks: true,
      gfm: true,
      headerIds: true,
    });

    // HTML 转 Markdown
    function convertHTMLToMarkdown() {
      const html = document.getElementById('htmlInput').value;
      if (!html.trim()) {
        alert('请先输入 HTML 内容');
        return;
      }

      try {
        // 创建一个临时容器来解析 HTML
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        
        // 处理链接，添加 target="_blank"
        const links = tempDiv.querySelectorAll('a');
        links.forEach(link => {
          if (link.href && !link.getAttribute('target')) {
            link.setAttribute('target', '_blank');
            link.setAttribute('rel', 'noopener noreferrer');
          }
        });

        // 转换为 Markdown
        const markdown = turndownService.turndown(tempDiv.innerHTML);
        document.getElementById('markdownOutput').value = markdown;
      } catch (error) {
        alert('转换失败：' + error.message);
        console.error(error);
      }
    }

    // Markdown 转 HTML
    function convertMarkdownToHTML() {
      const markdown = document.getElementById('markdownInput').value;
      if (!markdown.trim()) {
        alert('请先输入 Markdown 内容');
        return;
      }

      try {
        const html = marked.parse(markdown);
        
        // 处理链接，添加 target="_blank"
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        const links = tempDiv.querySelectorAll('a');
        links.forEach(link => {
          if (link.href && !link.href.startsWith('#')) {
            link.setAttribute('target', '_blank');
            link.setAttribute('rel', 'noopener noreferrer');
          }
        });

        document.getElementById('htmlOutput').value = tempDiv.innerHTML;
      } catch (error) {
        alert('转换失败：' + error.message);
        console.error(error);
      }
    }

    // 复制功能
    function copyMarkdown() {
      const markdown = document.getElementById('markdownOutput').value;
      if (!markdown.trim()) {
        alert('没有可复制的内容');
        return;
      }
      navigator.clipboard.writeText(markdown).then(() => {
        alert('Markdown 已复制到剪贴板！');
      }).catch(err => {
        alert('复制失败：' + err.message);
      });
    }

    function copyHTML() {
      const html = document.getElementById('htmlOutput').value;
      if (!html.trim()) {
        alert('没有可复制的内容');
        return;
      }
      navigator.clipboard.writeText(html).then(() => {
        alert('HTML 已复制到剪贴板！');
      }).catch(err => {
        alert('复制失败：' + err.message);
      });
    }

    // 清空功能
    function clearHTML() {
      document.getElementById('htmlInput').value = '';
      document.getElementById('markdownOutput').value = '';
    }

    function clearMarkdown() {
      document.getElementById('markdownInput').value = '';
      document.getElementById('htmlOutput').value = '';
    }

    // 快捷键支持
    document.getElementById('htmlInput').addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'Enter') {
        convertHTMLToMarkdown();
      }
    });

    document.getElementById('markdownInput').addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'Enter') {
        convertMarkdownToHTML();
      }
    });
  </script>
</body>
</html>

